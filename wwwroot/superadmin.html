<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword" content="">
    <meta name="author" content="flexilecode">
    <!--! The above 6 meta tags *must* come first in the head; any other head content must come *after* these tags !-->
    <!--! BEGIN: Apps Title-->
    <title>ITAMS || Super Admin Console</title>
    <!--! END:  Apps Title-->
    <!--! BEGIN: Favicon-->
    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.ico">
    <!--! END: Favicon-->
    <!--! BEGIN: Bootstrap CSS-->
    <link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css">
    <!--! END: Bootstrap CSS-->
    <!--! BEGIN: Vendors CSS-->
    <link rel="stylesheet" type="text/css" href="assets/vendors/css/vendors.min.css">
    <link rel="stylesheet" type="text/css" href="assets/vendors/css/dataTables.bs5.min.css">
    <link rel="stylesheet" type="text/css" href="assets/vendors/css/select2.min.css">
    <link rel="stylesheet" type="text/css" href="assets/vendors/css/select2-theme.min.css">
    <!--! END: Vendors CSS-->
    <!--! BEGIN: Custom CSS-->
    <link rel="stylesheet" type="text/css" href="assets/css/theme.min.css">
    <!--! END: Custom CSS-->
    <!--! HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries !-->
    <!--! WARNING: Respond.js doesn"t work if you view the page via file: !-->
    <!--[if lt IE 9]>
			<script src="https:oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https:oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
</head>

<body>
    <!--! ================================================================ !-->
    <!--! [Start] Navigation Menu !-->
    <!--! ================================================================ !-->
    <nav class="nxl-navigation">
        <div class="navbar-wrapper">
            <div class="m-header">
                <a href="superadmin.html" class="b-brand">
                    <!-- ITAMS Logo -->
                    <div class="logo logo-lg d-flex align-items-center">
                        <div class="avatar-text avatar-lg bg-primary text-white me-2">
                            <i class="feather-server"></i>
                        </div>
                        <h4 class="text-dark mb-0 fw-bold">ITAMS</h4>
                    </div>
                    <div class="logo logo-sm">
                        <div class="avatar-text avatar-md bg-primary text-white">
                            <i class="feather-server"></i>
                        </div>
                    </div>
                </a>
            </div>
            <div class="navbar-content">
                <ul class="nxl-navbar">
                    <li class="nxl-item nxl-caption">
                        <label>ITAMS Administration</label>
                    </li>
                    <li class="nxl-item">
                        <a href="javascript:void(0);" class="nxl-link" onclick="showSection('dashboard')">
                            <span class="nxl-micon"><i class="feather-pie-chart"></i></span>
                            <span class="nxl-mtext">Dashboard</span>
                        </a>
                    </li>
                    <li class="nxl-item nxl-hasmenu">
                        <a href="javascript:void(0);" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-users"></i></span>
                            <span class="nxl-mtext">User Management</span><span class="nxl-arrow"><i class="feather-chevron-right"></i></span>
                        </a>
                        <ul class="nxl-submenu">
                            <li class="nxl-item"><a class="nxl-link" href="javascript:void(0);" onclick="showSection('users')">All Users</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="javascript:void(0);" onclick="showCreateUserModal()">Add New User</a></li>
                        </ul>
                    </li>
                    <li class="nxl-item nxl-hasmenu">
                        <a href="javascript:void(0);" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-folder"></i></span>
                            <span class="nxl-mtext">Project Management</span><span class="nxl-arrow"><i class="feather-chevron-right"></i></span>
                        </a>
                        <ul class="nxl-submenu">
                            <li class="nxl-item"><a class="nxl-link" href="javascript:void(0);" onclick="showSection('projects')">All Projects</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="javascript:void(0);" onclick="showCreateProjectModal()">Add New Project</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="javascript:void(0);" onclick="showSection('locations')">Locations</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="javascript:void(0);" onclick="showSection('user-assignments')">User Assignments</a></li>
                        </ul>
                    </li>
                    <li class="nxl-item">
                        <a href="javascript:void(0);" class="nxl-link" onclick="showSection('audit')">
                            <span class="nxl-micon"><i class="feather-activity"></i></span>
                            <span class="nxl-mtext">Audit Trail</span>
                        </a>
                    </li>
                    <li class="nxl-item nxl-caption">
                        <label>Asset Management</label>
                    </li>
                    <li class="nxl-item">
                        <a href="javascript:void(0);" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-server"></i></span>
                            <span class="nxl-mtext">Assets</span>
                        </a>
                    </li>
                    <li class="nxl-item">
                        <a href="javascript:void(0);" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-settings"></i></span>
                            <span class="nxl-mtext">System Settings</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!--! ================================================================ !-->
    <!--! [End]  Navigation Menu !-->
    <!--! ================================================================ !-->

    <!--! ================================================================ !-->
    <!--! [Start] Header !-->
    <!--! ================================================================ !-->
    <header class="nxl-header">
        <div class="header-wrapper">
            <!--! [Start] Header Left !-->
            <div class="header-left d-flex align-items-center gap-4">
                <!--! [Start] nxl-head-mobile-toggler !-->
                <a href="javascript:void(0);" class="nxl-head-mobile-toggler" id="mobile-collapse">
                    <div class="hamburger hamburger--arrowturn">
                        <div class="hamburger-box">
                            <div class="hamburger-inner"></div>
                        </div>
                    </div>
                </a>
                <!--! [Start] nxl-head-mobile-toggler !-->
                <!--! [Start] nxl-navigation-toggle !-->
                <div class="nxl-navigation-toggle">
                    <a href="javascript:void(0);" id="menu-mini-button">
                        <i class="feather-align-left"></i>
                    </a>
                    <a href="javascript:void(0);" id="menu-expend-button" style="display: none">
                        <i class="feather-arrow-right"></i>
                    </a>
                </div>
                <!--! [End] nxl-navigation-toggle !-->
            </div>
            <!--! [End] Header Left !-->
            <!--! [Start] Header Right !-->
            <div class="header-right ms-auto">
                <div class="d-flex align-items-center">
                    <div class="dropdown nxl-h-item">
                        <a href="javascript:void(0);" data-bs-toggle="dropdown" role="button" data-bs-auto-close="outside">
                            <div class="avatar-text avatar-md bg-primary text-white">
                                <i class="feather-user"></i>
                            </div>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end nxl-h-dropdown nxl-user-dropdown">
                            <div class="dropdown-header">
                                <div class="d-flex align-items-center">
                                    <div class="avatar-text avatar-lg bg-primary text-white me-3">
                                        <i class="feather-user"></i>
                                    </div>
                                    <div>
                                        <h6 class="text-dark mb-0">Super Admin <span class="badge bg-success ms-1">PRO</span></h6>
                                        <span class="fs-12 fw-medium text-muted">superadmin@itams.com</span>
                                    </div>
                                </div>
                            </div>
                            <div class="dropdown">
                                <a href="javascript:void(0);" class="dropdown-item">
                                    <i class="feather-user"></i>
                                    <span>Profile Details</span>
                                </a>
                                <a href="javascript:void(0);" class="dropdown-item">
                                    <i class="feather-settings"></i>
                                    <span>Account Settings</span>
                                </a>
                                <div class="dropdown-divider"></div>
                                <a href="javascript:void(0);" class="dropdown-item">
                                    <i class="feather-log-out"></i>
                                    <span>Logout</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--! [End] Header Right !-->
        </div>
    </header>
    <!--! ================================================================ !-->
    <!--! [End] Header !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! [Start] Main Content !-->
    <!--! ================================================================ !-->
    <main class="nxl-container">
        <div class="nxl-content">
            <!-- [ page-header ] start -->
            <div class="page-header">
                <div class="page-header-left d-flex align-items-center">
                    <div class="page-header-title">
                        <h5 class="m-b-10" id="page-title">Dashboard</h5>
                    </div>
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item"><a href="superadmin.html">ITAMS</a></li>
                        <li class="breadcrumb-item" id="breadcrumb-current">Dashboard</li>
                    </ul>
                </div>
                <div class="page-header-right ms-auto">
                    <div class="page-header-right-items">
                        <div class="d-flex align-items-center gap-2 page-header-right-items-wrapper" id="page-header-actions">
                            <a href="javascript:void(0);" class="btn btn-primary" onclick="showCreateUserModal()">
                                <i class="feather-plus me-2"></i>
                                <span>Add New User</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- [ page-header ] end -->

            <!-- [ Main Content ] start -->
            <div class="main-content">
                <!-- Dashboard Section -->
                <div id="dashboard-section" class="content-section">
                    <div class="row">
                        <div class="col-xxl-3 col-md-6">
                            <div class="card stretch stretch-full">
                                <div class="card-body">
                                    <div class="d-flex align-items-start justify-content-between mb-4">
                                        <div class="content-area">
                                            <h4 class="mb-0" id="total-users">0</h4>
                                            <p class="fs-11 text-muted mb-0">Total Users</p>
                                        </div>
                                        <div class="avatar-text avatar-lg bg-gray-200">
                                            <i class="feather-users"></i>
                                        </div>
                                    </div>
                                    <div class="pt-4 border-top border-gray-2">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <a href="javascript:void(0);" class="fs-13 fw-semibold text-primary">View Details</a>
                                            <div class="badge bg-gray-200 text-dark">All Time</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xxl-3 col-md-6">
                            <div class="card stretch stretch-full">
                                <div class="card-body">
                                    <div class="d-flex align-items-start justify-content-between mb-4">
                                        <div class="content-area">
                                            <h4 class="mb-0" id="active-users">0</h4>
                                            <p class="fs-11 text-muted mb-0">Active Users</p>
                                        </div>
                                        <div class="avatar-text avatar-lg bg-success text-white">
                                            <i class="feather-user-check"></i>
                                        </div>
                                    </div>
                                    <div class="pt-4 border-top border-gray-2">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <a href="javascript:void(0);" class="fs-13 fw-semibold text-success">View Details</a>
                                            <div class="badge bg-success text-white">Active</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xxl-3 col-md-6">
                            <div class="card stretch stretch-full">
                                <div class="card-body">
                                    <div class="d-flex align-items-start justify-content-between mb-4">
                                        <div class="content-area">
                                            <h4 class="mb-0" id="locked-users">0</h4>
                                            <p class="fs-11 text-muted mb-0">Locked Users</p>
                                        </div>
                                        <div class="avatar-text avatar-lg bg-warning text-white">
                                            <i class="feather-user-x"></i>
                                        </div>
                                    </div>
                                    <div class="pt-4 border-top border-gray-2">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <a href="javascript:void(0);" class="fs-13 fw-semibold text-warning">View Details</a>
                                            <div class="badge bg-warning text-white">Locked</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xxl-3 col-md-6">
                            <div class="card stretch stretch-full">
                                <div class="card-body">
                                    <div class="d-flex align-items-start justify-content-between mb-4">
                                        <div class="content-area">
                                            <h4 class="mb-0" id="super-admins">0</h4>
                                            <p class="fs-11 text-muted mb-0">Super Admins</p>
                                        </div>
                                        <div class="avatar-text avatar-lg bg-primary text-white">
                                            <i class="feather-shield"></i>
                                        </div>
                                    </div>
                                    <div class="pt-4 border-top border-gray-2">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <a href="javascript:void(0);" class="fs-13 fw-semibold text-primary">View Details</a>
                                            <div class="badge bg-primary text-white">Admin</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Management Section -->
                <div id="users-section" class="content-section" style="display: none;">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card stretch stretch-full">
                                <div class="card-header">
                                    <h5 class="card-title">User Management</h5>
                                    <div class="card-header-action">
                                        <div class="card-header-btn">
                                            <div data-bs-toggle="tooltip" title="Refresh">
                                                <a href="javascript:void(0);" class="avatar-text avatar-xs bg-warning" onclick="loadUsers()"> 
                                                    <i class="feather-refresh-cw"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body custom-card-action p-0">
                                    <div class="table-responsive">
                                        <table class="table table-hover mb-0" id="users-table">
                                            <thead>
                                                <tr class="border-b">
                                                    <th scope="row">Username</th>
                                                    <th>Name</th>
                                                    <th>Email</th>
                                                    <th>Role</th>
                                                    <th>Status</th>
                                                    <th>Last Login</th>
                                                    <th class="text-end">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="users-table-body">
                                                <!-- Users will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Audit Trail Section -->
                <div id="audit-section" class="content-section" style="display: none;">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card stretch stretch-full">
                                <div class="card-header">
                                    <h5 class="card-title">Audit Trail</h5>
                                    <div class="card-header-action">
                                        <div class="card-header-btn">
                                            <div data-bs-toggle="tooltip" title="Refresh">
                                                <a href="javascript:void(0);" class="avatar-text avatar-xs bg-warning" onclick="loadAuditTrail()"> 
                                                    <i class="feather-refresh-cw"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body custom-card-action p-0">
                                    <div class="table-responsive">
                                        <table class="table table-hover mb-0" id="audit-table">
                                            <thead>
                                                <tr class="border-b">
                                                    <th scope="row">Timestamp</th>
                                                    <th>Action</th>
                                                    <th>Entity Type</th>
                                                    <th>Entity ID</th>
                                                    <th>User</th>
                                                    <th>IP Address</th>
                                                </tr>
                                            </thead>
                                            <tbody id="audit-table-body">
                                                <!-- Audit entries will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Projects Section -->
                <div id="projects-section" class="content-section" style="display: none;">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card stretch stretch-full">
                                <div class="card-header">
                                    <h5 class="card-title">Project Management</h5>
                                    <div class="card-header-action">
                                        <div class="card-header-btn">
                                            <div data-bs-toggle="tooltip" title="Refresh">
                                                <a href="javascript:void(0);" class="avatar-text avatar-xs bg-warning" onclick="loadProjects()"> 
                                                    <i class="feather-refresh-cw"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body custom-card-action p-0">
                                    <div class="table-responsive">
                                        <table class="table table-hover mb-0" id="projects-table">
                                            <thead>
                                                <tr class="border-b">
                                                    <th scope="row">Project Name</th>
                                                    <th>Code</th>
                                                    <th>Description</th>
                                                    <th>Locations</th>
                                                    <th>Users</th>
                                                    <th>Status</th>
                                                    <th>Created</th>
                                                    <th class="text-end">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="projects-table-body">
                                                <!-- Projects will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Locations Section -->
                <div id="locations-section" class="content-section" style="display: none;">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card stretch stretch-full">
                                <div class="card-header">
                                    <h5 class="card-title">Location Management</h5>
                                    <div class="card-header-action">
                                        <div class="card-header-btn">
                                            <div data-bs-toggle="tooltip" title="Refresh">
                                                <a href="javascript:void(0);" class="avatar-text avatar-xs bg-warning" onclick="loadLocations()"> 
                                                    <i class="feather-refresh-cw"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-4">
                                            <label class="form-label">Select Project</label>
                                            <select class="form-select" id="project-filter" onchange="loadLocations()">
                                                <option value="">All Projects</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-hover mb-0" id="locations-table">
                                            <thead>
                                                <tr class="border-b">
                                                    <th scope="row">Location Name</th>
                                                    <th>Project</th>
                                                    <th>Region</th>
                                                    <th>State</th>
                                                    <th>Plaza</th>
                                                    <th>Lane</th>
                                                    <th>Assets</th>
                                                    <th>Status</th>
                                                    <th class="text-end">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="locations-table-body">
                                                <!-- Locations will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Assignments Section -->
                <div id="user-assignments-section" class="content-section" style="display: none;">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card stretch stretch-full">
                                <div class="card-header">
                                    <h5 class="card-title">User Project Assignments</h5>
                                    <div class="card-header-action">
                                        <div class="card-header-btn">
                                            <div data-bs-toggle="tooltip" title="Refresh">
                                                <a href="javascript:void(0);" class="avatar-text avatar-xs bg-warning" onclick="loadUserAssignments()"> 
                                                    <i class="feather-refresh-cw"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-4">
                                            <label class="form-label">Select User</label>
                                            <select class="form-select" id="user-filter" onchange="loadUserAssignments()">
                                                <option value="">All Users</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Select Project</label>
                                            <select class="form-select" id="assignment-project-filter" onchange="loadUserAssignments()">
                                                <option value="">All Projects</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4 d-flex align-items-end">
                                            <button class="btn btn-primary" onclick="showAssignUserModal()">
                                                <i class="feather-plus me-2"></i>Assign User to Project
                                            </button>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-hover mb-0" id="assignments-table">
                                            <thead>
                                                <tr class="border-b">
                                                    <th scope="row">User</th>
                                                    <th>Project</th>
                                                    <th>Role</th>
                                                    <th>Permissions</th>
                                                    <th>Assigned Date</th>
                                                    <th>Status</th>
                                                    <th class="text-end">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="assignments-table-body">
                                                <!-- User assignments will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- [ Main Content ] end -->
        </div>
    </main>
    <!--! ================================================================ !-->
    <!--! [End] Main Content !-->
    <!--! ================================================================ !-->

    <!-- Create User Modal -->
    <div class="modal fade" id="createUserModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createUserForm">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="mb-4">
                                    <label class="form-label">Username <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="username" required>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-4">
                                    <label class="form-label">Email <span class="text-danger">*</span></label>
                                    <input type="email" class="form-control" id="email" required>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-4">
                                    <label class="form-label">First Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="firstName" required>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-4">
                                    <label class="form-label">Last Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="lastName" required>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-4">
                                    <label class="form-label">Role <span class="text-danger">*</span></label>
                                    <select class="form-select" id="role" required>
                                        <option value="">Select Role</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-4">
                                    <label class="form-label">Password <span class="text-danger">*</span></label>
                                    <input type="password" class="form-control" id="password" required>
                                    <div class="form-text">Password must be at least 8 characters with uppercase, lowercase, digit, and special character.</div>
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="mustChangePassword" checked>
                                    <label class="form-check-label" for="mustChangePassword">
                                        Must change password on first login
                                    </label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createUser()">Create User</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Project Modal -->
    <div class="modal fade" id="createProjectModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Project</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createProjectForm">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="mb-4">
                                    <label class="form-label">Project Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="projectName" required>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-4">
                                    <label class="form-label">Project Code <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="projectCode" required>
                                    <div class="form-text">Unique identifier for the project (e.g., PROJ001)</div>
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="mb-4">
                                    <label class="form-label">Description</label>
                                    <textarea class="form-control" id="projectDescription" rows="3"></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createProject()">Create Project</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Location Modal -->
    <div class="modal fade" id="createLocationModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Location</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createLocationForm">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="mb-4">
                                    <label class="form-label">Location Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="locationName" required>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-4">
                                    <label class="form-label">Project <span class="text-danger">*</span></label>
                                    <select class="form-select" id="locationProject" required>
                                        <option value="">Select Project</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-4">
                                    <label class="form-label">Region <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="locationRegion" required>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-4">
                                    <label class="form-label">State <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="locationState" required>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-4">
                                    <label class="form-label">Plaza</label>
                                    <input type="text" class="form-control" id="locationPlaza">
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-4">
                                    <label class="form-label">Lane</label>
                                    <input type="text" class="form-control" id="locationLane">
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-4">
                                    <label class="form-label">Office</label>
                                    <input type="text" class="form-control" id="locationOffice">
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="mb-4">
                                    <label class="form-label">Address</label>
                                    <textarea class="form-control" id="locationAddress" rows="3"></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createLocation()">Create Location</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Assign User to Project Modal -->
    <div class="modal fade" id="assignUserModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Assign User to Project</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="assignUserForm">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="mb-4">
                                    <label class="form-label">User <span class="text-danger">*</span></label>
                                    <select class="form-select" id="assignUser" required>
                                        <option value="">Select User</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-4">
                                    <label class="form-label">Project <span class="text-danger">*</span></label>
                                    <select class="form-select" id="assignProject" required>
                                        <option value="">Select Project</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="mb-4">
                                    <label class="form-label">Permissions <span class="text-danger">*</span></label>
                                    <div id="permissions-list" class="border rounded p-3" style="max-height: 300px; overflow-y: auto;">
                                        <!-- Permissions will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="assignUserToProject()">Assign User</button>
                </div>
            </div>
        </div>
    </div>

    <!--! ================================================================ !-->
    <!--! [Start] Footer Script !-->
    <!--! ================================================================ !-->
    <!--! BEGIN: Vendors JS !-->
    <script src="assets/vendors/js/vendors.min.js"></script>
    <!-- vendors.min.js {always must need to be top} -->
    <script src="assets/vendors/js/dataTables.min.js"></script>
    <script src="assets/vendors/js/dataTables.bs5.min.js"></script>
    <script src="assets/vendors/js/select2.min.js"></script>
    <script src="assets/vendors/js/select2-active.min.js"></script>
    <!--! END: Vendors JS !-->
    <!--! BEGIN: Apps Init  !-->
    <script src="assets/js/common-init.min.js"></script>
    <!--! END: Apps Init !-->
    <!--! BEGIN: Theme Customizer  !-->
    <script src="assets/js/theme-customizer-init.min.js"></script>
    <!--! END: Theme Customizer !-->
    <script>
        const API_BASE = '/api/superadmin';

        // Show different sections
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(s => s.style.display = 'none');
            
            // Remove active class from all nav links
            document.querySelectorAll('.nxl-link').forEach(link => link.classList.remove('active'));
            
            // Show selected section
            document.getElementById(section + '-section').style.display = 'block';
            
            // Update page title and breadcrumb
            const titles = {
                'dashboard': 'Dashboard',
                'users': 'User Management',
                'projects': 'Project Management',
                'locations': 'Location Management',
                'user-assignments': 'User Project Assignments',
                'audit': 'Audit Trail'
            };
            document.getElementById('page-title').textContent = titles[section];
            document.getElementById('breadcrumb-current').textContent = titles[section];
            
            // Update page header actions
            const actionsDiv = document.getElementById('page-header-actions');
            if (section === 'users') {
                actionsDiv.innerHTML = `
                    <a href="javascript:void(0);" class="btn btn-primary" onclick="showCreateUserModal()">
                        <i class="feather-plus me-2"></i>
                        <span>Add New User</span>
                    </a>
                `;
            } else if (section === 'projects') {
                actionsDiv.innerHTML = `
                    <a href="javascript:void(0);" class="btn btn-primary" onclick="showCreateProjectModal()">
                        <i class="feather-plus me-2"></i>
                        <span>Add New Project</span>
                    </a>
                `;
            } else if (section === 'locations') {
                actionsDiv.innerHTML = `
                    <a href="javascript:void(0);" class="btn btn-primary" onclick="showCreateLocationModal()">
                        <i class="feather-plus me-2"></i>
                        <span>Add New Location</span>
                    </a>
                `;
            } else {
                actionsDiv.innerHTML = '';
            }
            
            // Load section data
            if (section === 'dashboard') {
                loadDashboard();
            } else if (section === 'users') {
                loadUsers();
            } else if (section === 'projects') {
                loadProjects();
            } else if (section === 'locations') {
                loadLocations();
            } else if (section === 'user-assignments') {
                loadUserAssignments();
            } else if (section === 'audit') {
                loadAuditTrail();
            }
        }

        // Load dashboard data
        async function loadDashboard() {
            try {
                const response = await fetch(`${API_BASE}/users`);
                const users = await response.json();
                
                document.getElementById('total-users').textContent = users.length;
                document.getElementById('active-users').textContent = users.filter(u => u.isActive).length;
                document.getElementById('locked-users').textContent = users.filter(u => u.isLocked).length;
                document.getElementById('super-admins').textContent = users.filter(u => u.roleId === 1).length;
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        // Load roles for dropdowns
        async function loadRoles() {
            try {
                const response = await fetch(`${API_BASE}/roles`);
                const roles = await response.json();
                
                const roleSelect = document.getElementById('role');
                roleSelect.innerHTML = '<option value="">Select Role</option>';
                roles.forEach(role => {
                    roleSelect.innerHTML += `<option value="${role.id}">${role.name}</option>`;
                });
            } catch (error) {
                console.error('Error loading roles:', error);
            }
        }

        // Load users
        async function loadUsers() {
            try {
                const response = await fetch(`${API_BASE}/users`);
                const users = await response.json();
                
                const tbody = document.getElementById('users-table-body');
                tbody.innerHTML = '';
                
                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div class="d-flex align-items-center gap-3">
                                <div class="avatar-text avatar-md">
                                    <i class="feather-user"></i>
                                </div>
                                <div>
                                    <span class="d-block">${user.username}</span>
                                </div>
                            </div>
                        </td>
                        <td><span class="badge bg-gray-200 text-dark">${user.firstName} ${user.lastName}</span></td>
                        <td>${user.email}</td>
                        <td><span class="badge bg-primary">${user.roleName}</span></td>
                        <td>
                            ${user.isActive ? 
                                (user.isLocked ? '<span class="badge bg-warning">Locked</span>' : '<span class="badge bg-success">Active</span>') :
                                '<span class="badge bg-danger">Inactive</span>'
                            }
                        </td>
                        <td>${user.lastLoginAt ? new Date(user.lastLoginAt).toLocaleDateString() : 'Never'}</td>
                        <td>
                            <div class="hstack gap-2 justify-content-end">
                                <a href="javascript:void(0);" class="avatar-text avatar-md" onclick="editUser(${user.id})" data-bs-toggle="tooltip" title="Edit">
                                    <i class="feather-edit-3"></i>
                                </a>
                                <a href="javascript:void(0);" class="avatar-text avatar-md" onclick="resetPassword(${user.id})" data-bs-toggle="tooltip" title="Reset Password">
                                    <i class="feather-key"></i>
                                </a>
                                ${user.isLocked ? 
                                    `<a href="javascript:void(0);" class="avatar-text avatar-md" onclick="unlockUser(${user.id})" data-bs-toggle="tooltip" title="Unlock">
                                        <i class="feather-unlock"></i>
                                    </a>` :
                                    `<a href="javascript:void(0);" class="avatar-text avatar-md" onclick="lockUser(${user.id})" data-bs-toggle="tooltip" title="Lock">
                                        <i class="feather-lock"></i>
                                    </a>`
                                }
                                <a href="javascript:void(0);" class="avatar-text avatar-md" onclick="deleteUser(${user.id})" data-bs-toggle="tooltip" title="Delete">
                                    <i class="feather-trash-2"></i>
                                </a>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading users:', error);
                alert('Error loading users');
            }
        }

        // Load projects
        async function loadProjects() {
            try {
                const response = await fetch(`${API_BASE}/projects`);
                const projects = await response.json();
                
                const tbody = document.getElementById('projects-table-body');
                tbody.innerHTML = '';
                
                projects.forEach(project => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div class="d-flex align-items-center gap-3">
                                <div class="avatar-text avatar-md bg-primary">
                                    <i class="feather-folder"></i>
                                </div>
                                <div>
                                    <span class="d-block fw-semibold">${project.name}</span>
                                </div>
                            </div>
                        </td>
                        <td><span class="badge bg-secondary">${project.code}</span></td>
                        <td>${project.description || '-'}</td>
                        <td><span class="badge bg-info">${project.locationCount}</span></td>
                        <td><span class="badge bg-success">${project.userCount}</span></td>
                        <td>
                            ${project.isActive ? 
                                '<span class="badge bg-success">Active</span>' :
                                '<span class="badge bg-danger">Inactive</span>'
                            }
                        </td>
                        <td>${new Date(project.createdAt).toLocaleDateString()}</td>
                        <td>
                            <div class="hstack gap-2 justify-content-end">
                                <a href="javascript:void(0);" class="avatar-text avatar-md" onclick="viewProjectLocations(${project.id})" data-bs-toggle="tooltip" title="View Locations">
                                    <i class="feather-map-pin"></i>
                                </a>
                                <a href="javascript:void(0);" class="avatar-text avatar-md" onclick="editProject(${project.id})" data-bs-toggle="tooltip" title="Edit">
                                    <i class="feather-edit-3"></i>
                                </a>
                                <a href="javascript:void(0);" class="avatar-text avatar-md" onclick="deleteProject(${project.id})" data-bs-toggle="tooltip" title="Delete">
                                    <i class="feather-trash-2"></i>
                                </a>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading projects:', error);
                alert('Error loading projects');
            }
        }

        // Load locations
        async function loadLocations() {
            try {
                // Load projects for filter
                const projectsResponse = await fetch(`${API_BASE}/projects`);
                const projects = await projectsResponse.json();
                
                const projectFilter = document.getElementById('project-filter');
                projectFilter.innerHTML = '<option value="">All Projects</option>';
                projects.forEach(project => {
                    projectFilter.innerHTML += `<option value="${project.id}">${project.name}</option>`;
                });

                // Load locations
                const selectedProjectId = projectFilter.value;
                let locationsUrl = `${API_BASE}/projects/0/locations`; // This will need to be updated to get all locations
                
                // For now, let's load all locations by iterating through projects
                const tbody = document.getElementById('locations-table-body');
                tbody.innerHTML = '';
                
                for (const project of projects) {
                    const locationsResponse = await fetch(`${API_BASE}/projects/${project.id}/locations`);
                    const locations = await locationsResponse.json();
                    
                    locations.forEach(location => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="avatar-text avatar-md bg-info">
                                        <i class="feather-map-pin"></i>
                                    </div>
                                    <div>
                                        <span class="d-block fw-semibold">${location.name}</span>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge bg-primary">${project.name}</span></td>
                            <td>${location.region}</td>
                            <td>${location.state}</td>
                            <td>${location.plaza || '-'}</td>
                            <td>${location.lane || '-'}</td>
                            <td><span class="badge bg-info">${location.assetCount}</span></td>
                            <td>
                                ${location.isActive ? 
                                    '<span class="badge bg-success">Active</span>' :
                                    '<span class="badge bg-danger">Inactive</span>'
                                }
                            </td>
                            <td>
                                <div class="hstack gap-2 justify-content-end">
                                    <a href="javascript:void(0);" class="avatar-text avatar-md" onclick="editLocation(${location.id})" data-bs-toggle="tooltip" title="Edit">
                                        <i class="feather-edit-3"></i>
                                    </a>
                                    <a href="javascript:void(0);" class="avatar-text avatar-md" onclick="deleteLocation(${location.id})" data-bs-toggle="tooltip" title="Delete">
                                        <i class="feather-trash-2"></i>
                                    </a>
                                </div>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('Error loading locations:', error);
                alert('Error loading locations');
            }
        }

        // Load user assignments
        async function loadUserAssignments() {
            try {
                // Load users and projects for filters
                const [usersResponse, projectsResponse] = await Promise.all([
                    fetch(`${API_BASE}/users`),
                    fetch(`${API_BASE}/projects`)
                ]);
                
                const users = await usersResponse.json();
                const projects = await projectsResponse.json();
                
                // Populate filters
                const userFilter = document.getElementById('user-filter');
                userFilter.innerHTML = '<option value="">All Users</option>';
                users.forEach(user => {
                    userFilter.innerHTML += `<option value="${user.id}">${user.firstName} ${user.lastName} (${user.username})</option>`;
                });

                const projectFilter = document.getElementById('assignment-project-filter');
                projectFilter.innerHTML = '<option value="">All Projects</option>';
                projects.forEach(project => {
                    projectFilter.innerHTML += `<option value="${project.id}">${project.name}</option>`;
                });

                // Load assignments (this would need a new API endpoint)
                const tbody = document.getElementById('assignments-table-body');
                tbody.innerHTML = '<tr><td colspan="7" class="text-center">User assignments functionality coming soon...</td></tr>';
                
            } catch (error) {
                console.error('Error loading user assignments:', error);
                alert('Error loading user assignments');
            }
        }

        // Load audit trail
        async function loadAuditTrail() {
            try {
                const response = await fetch(`${API_BASE}/audit-trail`);
                const auditEntries = await response.json();
                
                const tbody = document.getElementById('audit-table-body');
                tbody.innerHTML = '';
                
                auditEntries.forEach(entry => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${new Date(entry.timestamp).toLocaleString()}</td>
                        <td><span class="badge bg-secondary">${entry.action}</span></td>
                        <td>${entry.entityType}</td>
                        <td>${entry.entityId || '-'}</td>
                        <td>${entry.userName}</td>
                        <td>${entry.ipAddress || '-'}</td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading audit trail:', error);
                alert('Error loading audit trail');
            }
        }

        // Show create user modal
        function showCreateUserModal() {
            loadRoles(); // Load roles when opening modal
            const modal = new bootstrap.Modal(document.getElementById('createUserModal'));
            modal.show();
        }

        // Show create project modal
        function showCreateProjectModal() {
            const modal = new bootstrap.Modal(document.getElementById('createProjectModal'));
            modal.show();
        }

        // Show create location modal
        async function showCreateLocationModal() {
            try {
                // Load projects for dropdown
                const response = await fetch(`${API_BASE}/projects`);
                const projects = await response.json();
                
                const projectSelect = document.getElementById('locationProject');
                projectSelect.innerHTML = '<option value="">Select Project</option>';
                projects.forEach(project => {
                    projectSelect.innerHTML += `<option value="${project.id}">${project.name}</option>`;
                });

                const modal = new bootstrap.Modal(document.getElementById('createLocationModal'));
                modal.show();
            } catch (error) {
                console.error('Error loading projects for location modal:', error);
                alert('Error loading projects');
            }
        }

        // Show assign user modal
        async function showAssignUserModal() {
            try {
                // Load users and projects
                const [usersResponse, projectsResponse, permissionsResponse] = await Promise.all([
                    fetch(`${API_BASE}/users`),
                    fetch(`${API_BASE}/projects`),
                    fetch(`${API_BASE}/permissions`)
                ]);
                
                const users = await usersResponse.json();
                const projects = await projectsResponse.json();
                const permissions = await permissionsResponse.json();
                
                // Populate user dropdown
                const userSelect = document.getElementById('assignUser');
                userSelect.innerHTML = '<option value="">Select User</option>';
                users.forEach(user => {
                    userSelect.innerHTML += `<option value="${user.id}">${user.firstName} ${user.lastName} (${user.username})</option>`;
                });

                // Populate project dropdown
                const projectSelect = document.getElementById('assignProject');
                projectSelect.innerHTML = '<option value="">Select Project</option>';
                projects.forEach(project => {
                    projectSelect.innerHTML += `<option value="${project.id}">${project.name}</option>`;
                });

                // Populate permissions
                const permissionsList = document.getElementById('permissions-list');
                permissionsList.innerHTML = '';
                
                // Group permissions by module
                const groupedPermissions = permissions.reduce((groups, permission) => {
                    if (!groups[permission.module]) {
                        groups[permission.module] = [];
                    }
                    groups[permission.module].push(permission);
                    return groups;
                }, {});

                Object.keys(groupedPermissions).forEach(module => {
                    const moduleDiv = document.createElement('div');
                    moduleDiv.className = 'mb-3';
                    moduleDiv.innerHTML = `
                        <h6 class="mb-2">${module}</h6>
                        ${groupedPermissions[module].map(permission => `
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="${permission.id}" id="perm_${permission.id}">
                                <label class="form-check-label" for="perm_${permission.id}">
                                    ${permission.name}
                                    <small class="text-muted d-block">${permission.description}</small>
                                </label>
                            </div>
                        `).join('')}
                    `;
                    permissionsList.appendChild(moduleDiv);
                });

                const modal = new bootstrap.Modal(document.getElementById('assignUserModal'));
                modal.show();
            } catch (error) {
                console.error('Error loading data for assign user modal:', error);
                alert('Error loading data');
            }
        }

        // Create user
        async function createUser() {
            const form = document.getElementById('createUserForm');
            
            const userData = {
                username: document.getElementById('username').value,
                email: document.getElementById('email').value,
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                roleId: parseInt(document.getElementById('role').value),
                password: document.getElementById('password').value,
                mustChangePassword: document.getElementById('mustChangePassword').checked
            };

            try {
                const response = await fetch(`${API_BASE}/users`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });

                if (response.ok) {
                    alert('User created successfully');
                    bootstrap.Modal.getInstance(document.getElementById('createUserModal')).hide();
                    form.reset();
                    loadUsers();
                } else {
                    const error = await response.json();
                    alert('Error creating user: ' + error.message);
                }
            } catch (error) {
                console.error('Error creating user:', error);
                alert('Error creating user');
            }
        }

        // Create project
        async function createProject() {
            const form = document.getElementById('createProjectForm');
            
            const projectData = {
                name: document.getElementById('projectName').value,
                code: document.getElementById('projectCode').value,
                description: document.getElementById('projectDescription').value
            };

            try {
                const response = await fetch(`${API_BASE}/projects`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(projectData)
                });

                if (response.ok) {
                    alert('Project created successfully');
                    bootstrap.Modal.getInstance(document.getElementById('createProjectModal')).hide();
                    form.reset();
                    loadProjects();
                } else {
                    const error = await response.json();
                    alert('Error creating project: ' + error.message);
                }
            } catch (error) {
                console.error('Error creating project:', error);
                alert('Error creating project');
            }
        }

        // Create location
        async function createLocation() {
            const form = document.getElementById('createLocationForm');
            
            const locationData = {
                name: document.getElementById('locationName').value,
                projectId: parseInt(document.getElementById('locationProject').value),
                region: document.getElementById('locationRegion').value,
                state: document.getElementById('locationState').value,
                plaza: document.getElementById('locationPlaza').value,
                lane: document.getElementById('locationLane').value,
                office: document.getElementById('locationOffice').value,
                address: document.getElementById('locationAddress').value
            };

            try {
                const response = await fetch(`${API_BASE}/locations`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(locationData)
                });

                if (response.ok) {
                    alert('Location created successfully');
                    bootstrap.Modal.getInstance(document.getElementById('createLocationModal')).hide();
                    form.reset();
                    loadLocations();
                } else {
                    const error = await response.json();
                    alert('Error creating location: ' + error.message);
                }
            } catch (error) {
                console.error('Error creating location:', error);
                alert('Error creating location');
            }
        }

        // Assign user to project
        async function assignUserToProject() {
            const userId = document.getElementById('assignUser').value;
            const projectId = document.getElementById('assignProject').value;
            
            // Get selected permissions
            const permissionCheckboxes = document.querySelectorAll('#permissions-list input[type="checkbox"]:checked');
            const permissionIds = Array.from(permissionCheckboxes).map(cb => parseInt(cb.value));

            if (!userId || !projectId || permissionIds.length === 0) {
                alert('Please select user, project, and at least one permission');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/users/${userId}/projects/${projectId}/assign`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ permissionIds })
                });

                if (response.ok) {
                    alert('User assigned to project successfully');
                    bootstrap.Modal.getInstance(document.getElementById('assignUserModal')).hide();
                    loadUserAssignments();
                } else {
                    const error = await response.json();
                    alert('Error assigning user: ' + error.message);
                }
            } catch (error) {
                console.error('Error assigning user:', error);
                alert('Error assigning user');
            }
        }

        // View project locations
        function viewProjectLocations(projectId) {
            document.getElementById('project-filter').value = projectId;
            showSection('locations');
        }

        // Edit project (placeholder)
        function editProject(projectId) {
            alert('Edit project functionality coming soon...');
        }

        // Delete project
        async function deleteProject(projectId) {
            if (!confirm('Are you sure you want to delete this project? This action cannot be undone.')) return;

            try {
                const response = await fetch(`${API_BASE}/projects/${projectId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('Project deleted successfully');
                    loadProjects();
                } else {
                    const error = await response.json();
                    alert('Error deleting project: ' + error.message);
                }
            } catch (error) {
                console.error('Error deleting project:', error);
                alert('Error deleting project');
            }
        }

        // Edit location (placeholder)
        function editLocation(locationId) {
            alert('Edit location functionality coming soon...');
        }

        // Delete location (placeholder)
        function deleteLocation(locationId) {
            alert('Delete location functionality coming soon...');
        }
        async function resetPassword(userId) {
            const newPassword = prompt('Enter new password:');
            if (!newPassword) return;

            try {
                const response = await fetch(`${API_BASE}/users/${userId}/reset-password`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ newPassword })
                });

                if (response.ok) {
                    alert('Password reset successfully');
                } else {
                    const error = await response.json();
                    alert('Error resetting password: ' + error.message);
                }
            } catch (error) {
                console.error('Error resetting password:', error);
                alert('Error resetting password');
            }
        }

        // Lock user
        async function lockUser(userId) {
            if (!confirm('Are you sure you want to lock this user?')) return;

            try {
                const response = await fetch(`${API_BASE}/users/${userId}/lock`, {
                    method: 'POST'
                });

                if (response.ok) {
                    alert('User locked successfully');
                    loadUsers();
                } else {
                    const error = await response.json();
                    alert('Error locking user: ' + error.message);
                }
            } catch (error) {
                console.error('Error locking user:', error);
                alert('Error locking user');
            }
        }

        // Unlock user
        async function unlockUser(userId) {
            try {
                const response = await fetch(`${API_BASE}/users/${userId}/unlock`, {
                    method: 'POST'
                });

                if (response.ok) {
                    alert('User unlocked successfully');
                    loadUsers();
                } else {
                    const error = await response.json();
                    alert('Error unlocking user: ' + error.message);
                }
            } catch (error) {
                console.error('Error unlocking user:', error);
                alert('Error unlocking user');
            }
        }

        // Delete user
        async function deleteUser(userId) {
            if (!confirm('Are you sure you want to delete this user? This action cannot be undone.')) return;

            try {
                const response = await fetch(`${API_BASE}/users/${userId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('User deleted successfully');
                    loadUsers();
                } else {
                    const error = await response.json();
                    alert('Error deleting user: ' + error.message);
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                alert('Error deleting user');
            }
        }

        // Load dashboard on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
            loadRoles(); // Load roles for dropdowns
        });
    </script>
</body>

</html>